# trigger:
#   branches:
#     include:
#       - main

# pool:
#   name: Default  # Replace 'Default' with the name of your self-hosted agent pool.

# steps:
# - checkout: self
#   fetchDepth: 1

# - task: NodeTool@0
#   inputs:
#     versionSpec: '16.x'
#     addToPath: true

# - script: |
#     npm install
#     npm run build
#   displayName: 'Install Dependencies and Build'

# - script: |
#     npm test
#   displayName: 'Run Tests'

# - task: PublishBuildArtifacts@1
#   inputs:
#     pathtoPublish: '$(Build.ArtifactStagingDirectory)'
#     artifactName: 'drop'
#     publishLocation: 'Container'

# - script: |
#     curl -X POST -H "Authorization: Bearer $(RENDER_API_KEY)" \
#     -H "Content-Type: application/json" \
#     -d '{"serviceId": "azure-cicd", "clearCache": true}' \
#     "https://api.render.com/v1/services/azure-cicd/deploy"
#   displayName: 'Trigger Deploy on Render'

trigger:
  branches:
    include:
      - main

pool:
  name: Default  # Replace 'Default' with the name of your self-hosted agent pool.

steps:
- checkout: self
  fetchDepth: 1

- task: NodeTool@0
  inputs:
    versionSpec: '16.x'
    addToPath: true

- script: |
    npm install
    npm run build
  displayName: 'Install Dependencies and Build'

- script: |
    npm test
  displayName: 'Run Tests'

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'drop'
    publishLocation: 'Container'

- script: |
    curl -X POST https://api.render.com/v1/services/azure-cicd/deploy ^
    -H "Authorization: Bearer $(RENDER_API_KEY)" ^
    -H "Content-Type: application/json" ^
    -d "{\"serviceId\": \"azure-cicd\", \"clearCache\": true}"
  displayName: 'Trigger Deploy on Render'
